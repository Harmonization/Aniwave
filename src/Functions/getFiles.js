
const token = import.meta.env.VITE_DISK_TOKEN
const disk_url = import.meta.env.VITE_DISK_URL
const disk_section = import.meta.env.VITE_DISK_SECTION
const main_root = import.meta.env.VITE_DISK_FOLDER

import getUrl from '../Functions/getUrl.js'
import getFetch from '../Functions/getFetch.js'
import getDiskFolders from '../Functions/getDiskFolders.js'
import getDiskFiles from '../Functions/getDiskFiles.js'

export const getFiles = async () => {
    // Показать файлы с диска

    const diskFolders = await getDiskFolders()
    const files = await getDiskFiles()

    // Загрузка длин волн
    const nm = [
        397,
        400,
        403,
        406,
        409,
        412,
        415,
        418,
        420,
        423,
        426,
        429,
        432,
        435,
        438,
        441,
        444,
        446,
        449,
        452,
        455,
        458,
        461,
        464,
        467,
        470,
        473,
        476,
        478,
        481,
        484,
        487,
        490,
        493,
        496,
        499,
        502,
        505,
        508,
        510,
        513,
        516,
        519,
        522,
        525,
        528,
        531,
        534,
        537,
        540,
        543,
        546,
        549,
        551,
        554,
        557,
        560,
        563,
        566,
        569,
        572,
        575,
        578,
        581,
        584,
        587,
        590,
        593,
        596,
        599,
        602,
        605,
        607,
        610,
        613,
        616,
        619,
        622,
        625,
        628,
        631,
        634,
        637,
        640,
        643,
        646,
        649,
        652,
        655,
        658,
        661,
        664,
        667,
        670,
        673,
        676,
        679,
        682,
        685,
        688,
        691,
        694,
        697,
        700,
        703,
        706,
        709,
        712,
        715,
        718,
        721,
        724,
        727,
        730,
        733,
        736,
        739,
        742,
        745,
        748,
        751,
        754,
        757,
        760,
        763,
        766,
        769,
        772,
        775,
        778,
        781,
        784,
        787,
        790,
        793,
        796,
        799,
        802,
        805,
        808,
        811,
        814,
        817,
        820,
        823,
        826,
        829,
        832,
        835,
        838,
        841,
        844,
        847,
        850,
        853,
        856,
        859,
        862,
        866,
        869,
        872,
        875,
        878,
        881,
        884,
        887,
        890,
        893,
        896,
        899,
        902,
        905,
        908,
        911,
        914,
        917,
        920,
        924,
        927,
        930,
        933,
        936,
        939,
        942,
        945,
        948,
        951,
        954,
        957,
        960,
        963,
        967,
        970,
        973,
        976,
        979,
        982,
        985,
        988,
        991,
        994,
        997,
        1000,
        1004
    ]

    // Раскраски
    const colors = [
    'Earth',
    'Blackbody',
    'Bluered',
    'Blues',
    'Cividis',
    'Electric',
    'Greens',
    'Greys',
    'Hot',
    'Jet',
    'Picnic',
    'Portland',
    'Rainbow',
    'RdBu',
    'Reds',
    'Viridis',
    'YlGnBu',
    'YlOrRd'
    ]
    
    const colorsDict = Object.assign({}, ...Object.entries({...colors}).map(([a,b]) => ({ [b]: b })))

    // Выбранный сервер
    const serverUrl = await getUrl()
    console.log(serverUrl)

    // Загрузка настроек
    // const settings = await getFetch(serverUrl, 'settings')

    const settings = {
        "channel": "b0",
        "index_story": [
            "(nm757 - nm607) / (nm757 + nm607)",
            "(b120 - b70) / (b120 + b70)",
            "nm397",
            "nm406 - b10 / nm1004 + 1",
            " b10 / b0",
            "b70",
            "b120",
            "b150 + sin(b140)",
            "b30 * b60",
            "b203",
            "b100 - b40"
        ],
        "rois_story": [
            "x0=120, x1=180, y0=10, y1=150",
            "x0=10, x1=50, y0=10, y1=50",
            "x0=250, x1=350, y0=400, y1=450",
            "x0=30, x1=60, y0=30, y1=60",
            "x0=100, x1=150, y0=100, y1=179",
            "x0=100, x1=150, y0=99, y1=150",
            "x0=100, x1=150, y0=99, y1=159",
            "x0=333, x1=400, y0=250, y1=320",
            "x0=225, x1=300, y0=280, y1=345",
            "x0=120, x1=180, y0=10, y1=150",
            "x0=10, x1=50, y0=10, y1=50",
            "x0=250, x1=350, y0=400, y1=450",
            "x0=30, x1=60, y0=30, y1=60",
            "x0=100, x1=150, y0=100, y1=179",
            "x0=100, x1=150, y0=99, y1=150",
            "x0=100, x1=150, y0=99, y1=159",
            "x0=333, x1=400, y0=250, y1=320",
            "x0=225, x1=300, y0=280, y1=345",
            "x0=120, x1=180, y0=10, y1=150",
            "x0=10, x1=50, y0=10, y1=50",
            "x0=250, x1=350, y0=400, y1=450",
            "x0=30, x1=60, y0=30, y1=60",
            "x0=100, x1=150, y0=100, y1=179",
            "x0=100, x1=150, y0=99, y1=150",
            "x0=100, x1=150, y0=99, y1=159",
            "x0=333, x1=400, y0=250, y1=320",
            "x0=225, x1=300, y0=280, y1=345",
            "x0=100, x1=150, y0=99, y1=159",
            "x0=333, x1=400, y0=250, y1=320",
            "x0=225, x1=300, y0=280, y1=345"
        ],
        "colormap": "Rainbow",
        "filter": "golay",
        "h": 5,
        "t1": -0.46,
        "t2": 0.75
    }

    // Какие файлы уже есть на сервере
    const { downloadedFiles:downloadFiles } = await getFetch(serverUrl, 'files')
    const downloadedFiles = downloadFiles.filter(file => !file.includes('nm.npy'))

    const diskFiles = files.filter(file => downloadFiles.indexOf(file) === -1)

    return {files, nm, settings, colorsDict, serverUrl, downloadedFiles, diskFiles, diskFolders}
}